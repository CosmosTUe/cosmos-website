{% extends 'base.html' %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="col s12 l12">
    <div class="card grey lighten-5">
        <div class="card-content">
            <div class="card-image">
              <img src="/static/assets/img/members_flat.jpg">
              <span class="card-title">Your Profile <i class="material-icons left" style="">perm_identity</i></span>
            </div>
            <br/>
            <form method="post" action="{% url 'update_profile' %}">
            {% csrf_token %}
            <table>
                <tr>
                    <td class="input-field">
                        <input id="id" maxlength="254" name="id" class="validate" readonly type="text" value="{{ request.user.id }}" />
                        <label for="id">ID</label>
                    </td>
                </tr>
                <tr>
                    <td class="input-field">
                        <input id="id_username" maxlength="254" name="email" class="validate" type="text" value="{{ request.user.email }}" />
                        <label for="id_username">E-mail Address</label>
                    </td>
                </tr>
            </table>
                <button class="btn waves-effect waves-light" type="submit" value="login" name="action">Change
                    <i class="material-icons right">send</i>
                </button>

                <input type="hidden" name="next" value="/" />
            </form>
        </div>
    </div>
</div>
<div id="modal-success" class="modal">
    <div class="modal-content">
        <h4>Success</h4>
        <p>Your profile information was updated successfuly</p>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Ok, nice!</a>
    </div>
</div>
<!-- TODO: MAKE NOT SKETCHY -->
<script type="text/javascript">
    $(document).ready(function(){
      $('.modal').modal();
      var updated = getParameterByName('updated');
      if (updated) {
        $('#modal-success').modal('open');
      }
    });

    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
</script>
{% endblock %}
